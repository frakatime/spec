# Frakatime Specification

## Current Version
`v1`

## REST API
### Prefix
All methods should be available at `/api/vCURRENT_VERSION` (E.g. `/api/v1/health`).

### Authentication
A username and password should be provided by the server by default. For example, `ft-server-node` uses the `USERNAME` and `PASSWORD` env variables.\
All requests require authentication and should have the `Authorization` header. It should be formatted like this:
```
Authorization: Basic Base64Encoded(USERNAME PASSWORD)
```
For example,
```
Authorization: Basic dXNlciBwYXNzd2Q=
```
`dXNlciBwYXNzd2Q=` is a base64 encoded string that when decoded results in `user passwd`. `user` is the username and `passwd` is the password, separated by a space.

###  `GET /health`
This endpoint does not require authentication.\
Simple health check endpoint, should return `200` and
```json
{
    "status": "ok"
}
```

### `GET /time/:service`
Get the time you've spent on a "service" (can be anything) as a UNIX timestamp string.\
If the service doesn't exist, return `404` and
```json
{
    "status": "not found",
    "error": "service does not exist"
}
```
Otherwise, return `200` and
```json
{
    "time": "1765169654"
}
```

### `POST /service/:service`
Create a "service".\
If the service already exists, return `409` and
```json
{
    "status": "conflict",
    "error": "service already exists"
}
```
Otherwise, return `201` and
```json
{
    "status": "created"
}
```

### `PUT /service/:service`
Update the name of a "service".\
Request body:
```json
{
    "new_name": ""
}
```
If the service doesn't exist, return `404` and
```json
{
    "status": "not found",
    "error": "service does not exist"
}
```
Otherwise, return `200` and
```json
{
    "status": "ok"
}
```

### `DELETE /service/:service`
Delete a "service".\
If the service doesn't exist, return `404` and
```json
{
    "status": "not found",
    "error": "service does not exist"
}
```
Otherwise, return `200` and
```json
{
    "status": "ok"
}
```

## Time Tracking
The client reports time tracking to the server via a WebSocket endpoint, `/api/v1/ws/track`.\
Upon connection, the client should send the following message:
```
USERNAME:PASSWORD|SERVICE
```
The server checks for proper authentication, then checks if the service exists.
- If authentication fails, the server sends `unauthorized` and closes the connection.
- If the service doesn't exist, the server sends `non-existant service` and closes the connection.
- If successful, the server sends `ok`.

After receiving `ok`, the client sends `+` every second. The server internally adds a second to the tracked time on every message containing `+`.\
The client should close the WebSocket connection whenever the user stops using the "service".

## Errors
For incorrect authentication attempts, return `401` and
```json
{
    "status": "unauthorized"
}
```

For bad requests, return `400` and
```json
{
    "status": "bad request",
    "error": ""
}
```

You can optionally tell the client what they did wrong, or not.

For invalid endpoints, return `404` and
```json
{
    "status": "not found"
}
```

For any internal errors, return `500` and
```json
{
    "status": "internal server error",
    "error": "stack trace"
}
```
The `error` part is optional.

For any endpoints not implemented, return `501` and
```json
{
    "status": "not implemented"
}
```
